pipeline {
  agent any 
  environment {
    dockerimagename = "elevendevops/myelevendevopsimage"
    registry_url = "https://hub.docker.com/u/anand1957"
    registryCredential = 'docker-hub-cred'
    }
    tools {
        maven 'Apache-Maven-3.8.4'
    }
    stages {
        stage('Cleanup Workspace'){
            steps {
                script {
                    cleanWs()
                }
            }
        }
        stage('Cloning Git'){
            steps {
                checkout scm "https://github.com/DevSumu97/Sonar-11Devops.git"
            }
        }
        stage('Quality Gate'){
            steps {
                timeout(time: 2, unit: 'MINUTES') {
                 waitForQualityGate abortPipeline: true
                }
            }
        }
        stage('Build Package'){
            steps {
                sh 'mvn clean package'
            }
        }
        stage('Building image'){
            steps {
                script{
                  dockerImage = docker.build dockerimagename
                }
            }
        }
        stage('Pushing Image'){
            steps {
                script{
                  docker.withRegistry( registry_url, registryCredential ) {
            dockerImage.push("${env.BUILD_NUMBER}")
            dockerImage.push("latest")
                  }
                }
            }
        }
    }
}   
